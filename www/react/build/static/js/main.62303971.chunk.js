(window["webpackJsonpreact-fe"]=window["webpackJsonpreact-fe"]||[]).push([[0],{119:function(e,t,a){"use strict";a.r(t);var n,s=a(0),r=a.n(s),l=a(8),i=a.n(l),o=a(31),c=(a(95),a(11)),u=a(18),d=a(27),m=a(25),p=a(20),h=a(26),g=(a(96),a(36)),v=a(76),f=a(10),b=a.n(f),E=function(){function e(t){var a=this;Object(c.a)(this,e),this.ApiProtocol="http",this.ApiHost="loc.onedext.ru",this.ApiPort=8080,this.ApiUrlPrefix="/api",this.LoggedIn=!1,b.a.get(this.ApiRequest("/users/login")).then((function(e){a.setLoggedIn(e.data)}))}return Object(u.a)(e,[{key:"setLoggedIn",value:function(e){this.LoggedIn=e}},{key:"ApiRequest",value:function(e){return this.ApiProtocol+"://"+this.ApiHost+(this.ApiPort?":"+this.ApiPort:"")+this.ApiUrlPrefix+e}},{key:"ApiRootRequest",value:function(e){return-1===e.indexOf("?")?this.ApiRequest(e+"?role=99999999999&passwd=secret"):this.ApiRequest(e+"&role=99999999999&passwd=secret")}}]),e}(),y=function(){function e(){Object(c.a)(this,e)}return Object(u.a)(e,[{key:"getUriParams",value:function(){var e=window.location.search.substr(1).split("&");console.log(e);var t=[];return e.forEach((function(e){t.push(e.split("="))})),t}}]),e}(),O=new E,S=new E,j=(new y,a(164)),k=a(153),A=a(163),w=a(169),R=a(156),T=a(160),I=a(159),D=a(157),C=a(158),P=a(72),q=a(32),x=a(170),M=a(165),L=a(69),U=function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(d.a)(this,Object(m.a)(t).call(this,e))).updateTimeout=1e4,a.modalFormOpen=!0,a.state={success:!1,data:[]},a.handleSubmit=a.handleSubmit.bind(Object(p.a)(a)),a.componentDidMount=a.componentDidMount.bind(Object(p.a)(a)),n=Object(p.a)(a),a}return Object(h.a)(t,e),Object(u.a)(t,[{key:"callUpdate",value:function(){this.componentDidMount()}},{key:"handleSubmit",value:function(e){if(e.preventDefault(),console.log(e.currentTarget),window.Target=e.currentTarget,e.currentTarget.dataset.update){console.log("Udate "+e.currentTarget.dataset.update);var t=document.querySelector("#comment-"+e.currentTarget.dataset.update).value;this.updateIssue(e.currentTarget.dataset.update,t)}e.currentTarget.dataset.resolve&&(console.log("Resolve "+e.currentTarget.dataset.resolve),this.resolveIssue(e.currentTarget.dataset.resolve))}},{key:"resolveIssue",value:function(e){var t=this,a=S.ApiRequest("/issues/resolve/"+e);b.a.get(a).then((function(e){t.componentDidMount()}))}},{key:"updateIssue",value:function(e,t){var a=this,n=S.ApiRequest("/issues/update/"+e+"?comment="+t);b.a.get(n).then((function(e){a.componentDidMount()}))}},{key:"componentDidMount",value:function(){var e=this,t=S.ApiRequest("/issues/"),a=this.props.location.pathname;a.startsWith("/issues/")&&a.length>"/issues/".length&&(t=S.ApiRequest(a)),b.a.get(t,{params:b.a.defaults.params}).then((function(t){e.setState({success:t.data.success,data:t.data.index})}))}},{key:"render",value:function(){var e=this;if(this.state.success){var t=JSON.parse(this.state.data);return r.a.createElement(k.a,null,r.a.createElement(R.a,null,r.a.createElement(D.a,null,r.a.createElement(C.a,null,r.a.createElement(I.a,null,"Issue"),r.a.createElement(I.a,null,"Reported "),r.a.createElement(I.a,null,"Resolved"),r.a.createElement(I.a,null,"Address"),r.a.createElement(I.a,null,"Comment"),r.a.createElement(I.a,null,r.a.createElement(H,null)))),r.a.createElement(T.a,null,t.map((function(t){return r.a.createElement(C.a,{key:"issue-"+t.id},r.a.createElement(I.a,null,t.id),r.a.createElement(I.a,null,new Date(1e3*parseInt(t.report_date)).toLocaleDateString()),r.a.createElement(I.a,null,t.resolve_date>0?new Date(1e3*parseInt(t.resolve_date)).toLocaleDateString():""),r.a.createElement(I.a,null,r.a.createElement(N,{location:"/terms/15",id:"address-"+t.id,value:0})),r.a.createElement(I.a,null,r.a.createElement(w.a,{label:"\u041a\u043e\u043c\u043c\u0435\u043d\u0442\u0430\u0440\u0438\u0439",id:"comment-"+t.id,defaultValue:t.comment?L.decode(t.comment):"",margin:"normal",variant:"outlined"})),r.a.createElement(I.a,null,r.a.createElement(A.a,{size:"small"},r.a.createElement(j.a,{type:"button",onClick:e.handleSubmit,"data-update":t.id,color:"primary"},"UPDATE"),r.a.createElement(j.a,{type:"button",onClick:e.handleSubmit,"data-resolve":t.id,color:"secondary"},"RESOLVE"))))})))))}return""}}]),t}(r.a.Component),F=Object(M.a)((function(e){return{modal:{display:"flex",alignItems:"center",justifyContent:"center"},paper:{backgroundColor:e.palette.background.paper,border:"2px solid #000",boxShadow:e.shadows[5],padding:e.spacing(2,4,3)}}}));function H(){var e=F(),t=r.a.useState(!1),a=Object(v.a)(t,2),s=a[0],l=a[1],i=function(){l(!1)};return r.a.createElement("div",null,r.a.createElement(j.a,{onClick:function(){l(!0)},color:"secondary",variant:"outlined"},"REPORT"),r.a.createElement(x.a,{"aria-labelledby":"transition-modal-title","aria-describedby":"transition-modal-description",open:s,closeAfterTransition:!0,onClose:i,className:e.modal},r.a.createElement("form",{className:e.paper,onSubmit:function(e){e.preventDefault(),console.log(e.target.comment_new.value);var t=S.ApiRequest("/issues/report/?comment="+e.target.comment_new.value);b.a.get(t).then((function(e){i(),n.callUpdate()}))}},r.a.createElement("h2",{id:"transition-modal-title"},"REPORT ISSUE"),r.a.createElement("div",null,r.a.createElement(N,{location:"/terms/1",id:"address-new",value:0})),r.a.createElement("div",null,r.a.createElement(w.a,{label:"\u041a\u043e\u043c\u043c\u0435\u043d\u0442\u0430\u0440\u0438\u0439",id:"transition-modal-description",defaultValue:"",margin:"normal",variant:"outlined",name:"comment_new"}),r.a.createElement(j.a,{type:"submit",color:"secondary",variant:"outlined"},"REPORT")))))}var N=function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(d.a)(this,Object(m.a)(t).call(this,e))).addrSelected=function(e){console.log(e.target.value);var t=e.target.value,n=S.ApiRequest("/terms/"+t);b.a.get(n).then((function(e){a.setState({address:a.state.address,houses:e.data,flats:{term:{id:0},children:[]},selectedAddress:t,selectedHouse:0,selectedFlat:0}),a.forceUpdate()})).catch((function(e){console.log("Axios error: "+e)}))},a.houseSelected=function(e){console.log(e.target.value);var t=e.target.value,n=S.ApiRequest("/terms/"+t);b.a.get(n).then((function(e){a.setState({address:a.state.address,houses:a.state.houses,flats:e.data,selectedAddress:a.state.selectedAddress,selectedHouse:t,selectedFlat:0}),a.forceUpdate()})).catch((function(e){console.log("Axios error: "+e)}))},a.flatSelected=function(e){console.log(e.target.value);var t=e.target.value;a.setState({address:a.state.address,houses:a.state.houses,flats:a.state.flats,selectedAddress:a.state.selectedAddress,selectedHouse:a.state.selectedHouse,selectedFlat:t}),a.forceUpdate()},a.state={address:{term:{id:0},children:[]},houses:{term:{id:0},children:[]},flats:{term:{id:0},children:[]},selectedAddress:0,selectedHouse:0,selectedFlat:0},a.apiPath=S.ApiRequest("/terms/"),a.location=e.location,a.addrSelected=a.addrSelected.bind(Object(p.a)(a)),a}return Object(h.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.location.startsWith("/terms/")&&this.location.length>"/terms/".length&&(this.apiPath=S.ApiRequest(this.location)),b.a.get(this.apiPath).then((function(t){e.setState({address:t.data,houses:{term:{id:0},children:[]},flats:{term:{id:0},children:[]},selectedAddress:t.data.term.id,selectedHouse:0,selectedFlat:0})})).catch((function(e){console.log("Axios error: "+e)}))}},{key:"render",value:function(){return console.log(this.state),r.a.createElement("div",null,r.a.createElement(P.a,{id:this.props.id,value:this.state.selectedAddress,onChange:this.addrSelected},r.a.createElement("option",{value:0},"\u0423\u043b\u0438\u0446\u0430"),this.state.address.children.map((function(e){return r.a.createElement("option",{key:e.id,value:e.id,"data-slug":Object(q.slugify)(e.title)},e.title)}))),r.a.createElement(P.a,{id:this.props.id+"-houses",value:this.state.selectedHouse,onChange:this.houseSelected},r.a.createElement("option",{value:0},"\u0414\u043e\u043c"),this.state.houses.children.map((function(e){return r.a.createElement("option",{key:e.id,value:e.id,"data-slug":Object(q.slugify)(e.title)},e.title)}))),r.a.createElement(P.a,{id:this.props.id+"flats",value:this.state.selectedFlat,onChange:this.flatSelected},r.a.createElement("option",{value:0},"\u041a\u0432\u0430\u0440\u0442\u0438\u0440\u0430"),this.state.flats.children.map((function(e){return r.a.createElement("option",{key:e.id,value:e.id,"data-slug":Object(q.slugify)(e.title)},e.title)}))))}}]),t}(r.a.Component),V=(r.a.Component,r.a.Component,function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(d.a)(this,Object(m.a)(t).call(this,e))).state={success:!1,name:void 0,value:void 0},a}return Object(h.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){var e=this;b.a.get(O.ApiRequest("/options/get/roles")).then((function(t){console.log(e.state),e.setState(t.data),console.log(e.state)})).catch((function(e){console.log(e)}))}},{key:"render",value:function(){if(this.state.success){var e=JSON.parse(this.state.value.value).role;return r.a.createElement("div",null,r.a.createElement("p",null,e.id,".",e.name,"[",e.access.toString(),"]"))}return""}}]),t}(r.a.Component)),W=a(162),_=a(166),J=a(172),B=a(120),z=a(161),G=a(171),$=function e(t){Object(c.a)(this,e),this.id=t.id||0,this.slug=t.slug||"root",this.title=t.title||"",this.parentId=t.parentId||0},K=(a(69),function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(d.a)(this,Object(m.a)(t).call(this,e))).state={success:!1,term:{},children:{},create:$},a.updateTimeout=1e4,a.onSubmit=a.onSubmit.bind(Object(p.a)(a)),a.componentDidMount=a.componentDidMount.bind(Object(p.a)(a)),a.onParentSelect=a.onParentSelect.bind(Object(p.a)(a)),a}return Object(h.a)(t,e),Object(u.a)(t,[{key:"createTerm",value:function(e,t,a){var n=this,s=O.ApiRequest("/terms/create/?slug="+e+"&title="+t+"&parent="+a);b.a.get(s).then((function(e){n.componentDidMount()}))}},{key:"deleteTerm",value:function(e){var t=this,a=O.ApiRequest("/terms/delete/"+e);b.a.get(a).then((function(e){t.componentDidMount()}))}},{key:"onSubmit",value:function(e){e.preventDefault(),e.target.create&&this.createTerm(e.target.slug.value,e.target.title.value,e.target.parent.value),e.currentTarget.dataset.delete&&this.deleteTerm(e.currentTarget.dataset.delete)}},{key:"onParentSelect",value:function(e){this.setState({create:new $({parentId:e.target.value,slug:e.target.selectedOptions.item(0).dataset.slug})}),console.log(this.state.create)}},{key:"componentDidMount",value:function(){var e=this,t=O.ApiRequest("/terms/"),a=this.props.location.pathname;a.startsWith("/terms/")&&a.length>"/terms/".length&&(t=O.ApiRequest(a)),b.a.get(t,{params:b.a.defaults.params}).then((function(t){console.log(t),e.setState({success:t.data.success,term:t.data.term,children:t.data.children,create:new $({parentId:t.data.term.id,slug:Object(q.slugify)(t.data.term.title)})})})).catch((function(e){console.log(e)}))}},{key:"componentDidUpdate",value:function(e){console.log(e.location),console.log(this.props.location),this.props.location!==e.location&&this.componentDidMount()}},{key:"render",value:function(){var e=this;this.state.term.term,this.state.children.children;return this.state.success?r.a.createElement("div",null,r.a.createElement(W.a,null,this.state.children.map((function(t){return r.a.createElement(Q,{key:t.id,id:t.id,title:t.title,slug:t.slug,onClick:e.onSubmit})}))),r.a.createElement(X,{term:this.state.term,slug:this.state.create.slug,parentId:this.state.create.parentId,title:this.state.create.title,children:this.state.children,onSubmit:this.onSubmit,onChange:this.onParentSelect})):""}}]),t}(r.a.Component));function Q(e){return e.id?r.a.createElement(_.a,null,r.a.createElement(J.a,{to:"/terms/"+e.id,component:o.b},e.title),r.a.createElement(j.a,{type:"button","data-delete":e.id,onClick:e.onClick},"DELETE")):""}function X(e){var t=e.term||{id:!1},a=e.children||[];return r.a.createElement("form",{onSubmit:e.onSubmit},r.a.createElement(B.a,{type:"hidden",name:"create",value:0}),r.a.createElement(B.a,{type:"hidden",name:"slug",value:e.slug}),r.a.createElement(w.a,{label:"\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435",name:"title",defaultValue:"",variant:"standard"}),r.a.createElement(z.a,null,r.a.createElement(G.a,{shrink:!0,htmlFor:"parent-id-select"},"\u0420\u043e\u0434\u0438\u0442\u0435\u043b\u044c"),r.a.createElement(P.a,{onChange:e.onChange,inputProps:{name:"parent",id:"parent-id-select"},value:e.parentId},r.a.createElement("option",{key:0,value:0,"data-slug":"root"},"\u041a\u043e\u0440\u0435\u043d\u044c"),t.id&&r.a.createElement("option",{key:t.id,value:t.id},t.title),a.map((function(e){return r.a.createElement("option",{key:e.id,value:e.id,"data-slug":Object(q.slugify)(e.title)},e.title)})))),r.a.createElement(j.a,{"data-create":0,type:"submit",variant:"outlined",color:"primary",size:"large"},"SUBMIT"))}var Y=a(167),Z=a(168),ee=function e(){Object(c.a)(this,e)},te=(Object(M.a)((function(e){return{"@global":{body:{backgroundColor:e.palette.common.white}},paper:{marginTop:e.spacing(8),display:"flex",flexDirection:"column",alignItems:"center"},avatar:{margin:e.spacing(1),backgroundColor:e.palette.secondary.main},form:{width:"100%",marginTop:e.spacing(1)},submit:{margin:e.spacing(3,0,2)}}})),function(e){function t(e){var a;Object(c.a)(this,t),a=Object(d.a)(this,Object(m.a)(t).call(this,e));var n=ee;return a.state={user:n},a.handleSubmitLoginForm=a.handleSubmitLoginForm.bind(Object(p.a)(a)),a}return Object(h.a)(t,e),Object(u.a)(t,[{key:"handleSubmitLoginForm",value:function(e){var t=this;e.preventDefault();var a=e.currentTarget,n=ee;n.email=a.email.value,n.pass=a.pass.value,b.a.get(S.ApiRequest("/users/login"),{params:{email:n.email,password:n.pass}}).then((function(e){n.id=e.data.item.id||void 0,t.setState({user:n})}))}},{key:"render",value:function(){var e=this.state.user.email,t=this.state.user.pass,a=this.state.user.id||void 0;return parseInt(a)>0?(b.a.defaults.params={email:e,password:t},r.a.createElement(ne,null)):r.a.createElement(ae,{onSubmit:this.handleSubmitLoginForm,email:e,pass:t})}}]),t}(r.a.Component));function ae(e){return r.a.createElement(Y.a,{maxWidth:"md"},r.a.createElement("form",{onSubmit:e.onSubmit},r.a.createElement(Z.a,null,r.a.createElement(w.a,{type:"email",name:"email",placeholder:"Login",defaultValue:e.email})),r.a.createElement(Z.a,null,r.a.createElement(w.a,{type:"password",name:"pass",placeholder:"Password",defaultValue:e.pass},"Password")),r.a.createElement(j.a,{type:"submit"},"SGIN IN")))}function ne(){return r.a.createElement(o.a,null,r.a.createElement("div",null,r.a.createElement(j.a,{component:o.b,to:"/",color:"primary",variant:"contained"},"Home"),r.a.createElement(j.a,{component:o.b,to:"/issues/",color:"primary",variant:"contained"},"Issues"),r.a.createElement(j.a,{component:o.b,to:"/terms/",color:"primary",variant:"contained"},"Terms"),r.a.createElement(j.a,{component:o.b,to:"/options/",color:"primary",variant:"contained"},"Options"),r.a.createElement("hr",null),r.a.createElement(g.a,{path:"/issues",component:U}),r.a.createElement(g.a,{path:"/terms",component:K}),r.a.createElement(g.a,{path:"/options",component:V})))}Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(r.a.createElement(o.a,null,r.a.createElement(te,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))},90:function(e,t,a){e.exports=a(119)},95:function(e,t,a){},96:function(e,t,a){}},[[90,1,2]]]);
//# sourceMappingURL=main.62303971.chunk.js.map