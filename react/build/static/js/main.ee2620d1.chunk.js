(window["webpackJsonpreact-fe"]=window["webpackJsonpreact-fe"]||[]).push([[0],{113:function(e,t,a){e.exports=a(143)},143:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),l=a(8),i=a.n(l),o=a(14),c=a(21),s=a(34),m=a(30),u=a(16),d=a(35),p=a(9),h=a.n(p),g=new(function(){function e(t){var a=this;Object(o.a)(this,e),this.ApiProtocol="http",this.ApiHost="ispcp.onedext.ru",this.ApiPort=8080,this.ApiUrlPrefix="/api",this.LoggedIn=!1,h.a.get(this.ApiRequest("/users/login")).then((function(e){a.setLoggedIn(e.data)}))}return Object(c.a)(e,[{key:"setLoggedIn",value:function(e){this.LoggedIn=e}},{key:"ApiRequest",value:function(e){return this.ApiProtocol+"://"+this.ApiHost+(this.ApiPort?":"+this.ApiPort:"")+this.ApiUrlPrefix+e}},{key:"ApiRootRequest",value:function(e){return-1===e.indexOf("?")?this.ApiRequest(e+"?role=99999999999&passwd=secret"):this.ApiRequest(e+"&role=99999999999&passwd=secret")}}]),e}()),f=function e(){Object(o.a)(this,e),this.id=1,this.email="admin@isp.cp",this.pass="123456"},v=a(184),E=a(182),b=a(206),y=a(207),O=a(191),w=a(186),S=a(187),j=a(190),k=Object(E.a)({card:{minWidth:275},bullet:{display:"inline-block",margin:"0 2px",transform:"scale(0.8)"},title:{fontSize:14},pos:{marginBottom:12},cardContainer:{marginTop:"1.5em"}});function T(e){var t=k();return r.a.createElement(v.a,{className:t.cardContainer,maxWidth:"sm"},r.a.createElement(w.a,{className:t.card,maxWidth:"md",component:"form",onSubmit:e.onSubmit},r.a.createElement(S.a,null,r.a.createElement(b.a,{component:"div"},r.a.createElement(y.a,{type:"email",name:"email",placeholder:"Login",defaultValue:e.email})),r.a.createElement(b.a,{component:"div"},r.a.createElement(y.a,{type:"password",name:"pass",placeholder:"Password",defaultValue:e.pass},"Password"))),r.a.createElement(j.a,null,r.a.createElement(O.a,{type:"submit"},"SGIN IN"))))}var D=a(20),I=a(50),A=a(36),x=a(63),C=a.n(x),R=a(94),P=a(99),N=a(197),M=a(192),L=a(196),q=a(195),U=a(193),B=a(194),J=a(40),_=(a(139),function(){function e(){Object(o.a)(this,e),this.callApi=function(e,t,a){var n=t||{params:h.a.defaults.params};h.a.get(g.ApiRequest(e),n).then((function(e){a(e)}))}}return Object(c.a)(e,[{key:"getUriParams",value:function(){var e=window.location.search.substr(1).split("&");console.log(e);var t=[];return e.forEach((function(e){t.push(e.split("="))})),t}}]),e}()),W=a(208),F=a(93);function G(e){var t=e.onChange,a=e.children;return r.a.createElement(b.a,{component:"div"},r.a.createElement(F.a,{name:e.id,onChange:t,id:e.id,value:e.value},r.a.createElement("option",{key:"address-root-item-"+e.id,value:0},e.root_title),a.map((function(e){return r.a.createElement("option",{key:"address-item-"+e.id,value:e.id},e.title)}))))}var V=Object(E.a)((function(e){return{modal:{display:"flex",alignItems:"center",justifyContent:"center"},paper:{backgroundColor:e.palette.background.paper,border:"2px solid #000",boxShadow:e.shadows[5],padding:e.spacing(2,4,3)}}}));function H(e){var t=V(),a=r.a.useState(!1),n=Object(D.a)(a,2),l=n[0],i=n[1],o=r.a.useState({city:{},street:{},home:{},flat:{}}),c=Object(D.a)(o,2),s=c[0],m=c[1],u=r.a.useState([]),d=Object(D.a)(u,2),p=d[0],g=d[1],f=r.a.useState([]),v=Object(D.a)(f,2),E=v[0],w=v[1],S=r.a.useState([]),j=Object(D.a)(S,2),k=j[0],T=j[1],I=r.a.useState([]),A=Object(D.a)(I,2),x=A[0],C=A[1],R=r.a.useState([]),P=Object(D.a)(R,2),N=P[0],M=P[1],L=r.a.useState({id:0,title:""}),q=Object(D.a)(L,2),U=q[0],B=q[1],H=e.afterReport,z=function(){i(!1)},$=function(e){var t=Object.assign({},s);switch(e.target.id){case"city-new":t.city={title:e.target.selectedOptions.item(0).text,id:e.target.value},t.city.title=e.target.selectedOptions.item(0).text,(new _).callApi("/term/"+t.city.id,null,(function(e){w(e.data.term.children||[])}));break;case"street-new":t.street={title:e.target.selectedOptions.item(0).text,id:e.target.value},(new _).callApi("/term/"+t.street.id,null,(function(e){T(e.data.term.children||[])}));break;case"home-new":t.home={title:e.target.selectedOptions.item(0).text,id:e.target.value},(new _).callApi("/term/"+t.home.id,null,(function(e){C(e.data.term.children||[])}));break;case"flat-new":t.flat={title:e.target.selectedOptions.item(0).text,id:e.target.value}}m(t)};return 0===p.length&&(new _).callApi("/terms/"+Object(J.slugify)("\u0410\u0434\u0440\u0435\u0441\u0430"),null,(function(e){g(e.data.terms)})),0===N.length&&(new _).callApi("/terms/"+Object(J.slugify)("\u041c\u043e\u043d\u0442\u0430\u0436\u043d\u0438\u043a\u0438"),null,(function(e){M(e.data.terms)})),r.a.createElement("div",null,r.a.createElement(O.a,{onClick:function(){i(!0)},color:"secondary",variant:"outlined"},"REPORT"),r.a.createElement(W.a,{"aria-labelledby":"transition-modal-title","aria-describedby":"transition-modal-description",open:l,closeAfterTransition:!0,onClose:z,className:t.modal},r.a.createElement(b.a,{component:"form",className:t.paper,onSubmit:function(e){e.preventDefault();var t=Object.assign({address:s},{engineer:U},{comment:e.target.comment_new.value});(new _).callApi("/issues/report/",{params:{email:h.a.defaults.params.email,password:h.a.defaults.params.password,comment:t}},(function(){z(),H()}))}},r.a.createElement("h2",{id:"transition-modal-title"},"REPORT ISSUE"),r.a.createElement(b.a,{component:"div"},r.a.createElement(G,{root_title:"\u0413\u043e\u0440\u043e\u0434",value:s.city.id,children:p,onChange:$,id:"city-new"}),r.a.createElement(G,{root_title:"\u0423\u043b\u0438\u0446\u0430",value:s.street.id,children:E,onChange:$,id:"street-new"}),r.a.createElement(G,{root_title:"\u0414\u043e\u043c",value:s.home.id,children:k,onChange:$,id:"home-new"}),r.a.createElement(G,{root_title:"\u041a\u0432\u0430\u0440\u0442\u0438\u0440\u0430",value:s.flat.id,children:x,onChange:$,id:"flat-new"})),r.a.createElement(b.a,{component:"div"},r.a.createElement(F.a,{value:U.id,onChange:function(e){B({title:e.target.selectedOptions.item(0).text,id:e.target.value})}},r.a.createElement("option",{value:0},"\u041c\u043e\u043d\u0442\u0430\u0436\u043d\u0438\u043a"),N.map((function(e){return r.a.createElement("option",{key:"engineer-id-"+e.id,value:e.id},e.title)})))),r.a.createElement(b.a,{component:"div"},r.a.createElement(y.a,{label:"\u041a\u043e\u043c\u043c\u0435\u043d\u0442\u0430\u0440\u0438\u0439",id:"transition-modal-description",defaultValue:"",margin:"normal",variant:"outlined",name:"comment_new"}),r.a.createElement(O.a,{type:"submit",color:"secondary",variant:"outlined"},"REPORT")))))}var z={city:{id:0,title:""},street:{id:0,title:""},home:{id:0,title:""},flat:{id:0,title:""}},$={id:0,title:""},K=a(87),Q=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(s.a)(this,Object(m.a)(t).call(this,e))).updateTimeout=1e4,a.modalFormOpen=!0,a.passState=function(e){e.data.index=JSON.parse(e.data.index),console.log(e.data.index),e.data.index.map(function(){var e=Object(R.a)(C.a.mark((function e(t){var a,n;return C.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=K.decode(t.comment),console.log(a),t.comment={address:z,engineer:$,comment:""};try{"object"===typeof(n=JSON.parse(a))?t.comment=n:t.comment.comment=n}catch(r){t.comment.comment=JSON.parse(a)}case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),console.log(e.data.index),a.setState((function(){return{success:e.data.success,data:e.data.index}}))},a.state={success:!1,data:[]},a.ispcpHelper=new _,a.passState=a.passState.bind(Object(u.a)(a)),a.handleSubmit=a.handleSubmit.bind(Object(u.a)(a)),a.componentDidMount=a.componentDidMount.bind(Object(u.a)(a)),a.callUpdate=a.callUpdate.bind(Object(u.a)(a)),Object(u.a)(a),a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"callUpdate",value:function(){this.componentDidMount()}},{key:"handleSubmit",value:function(e){if(e.preventDefault(),console.log(e.currentTarget),window.Target=e.currentTarget,e.currentTarget.dataset.update){console.log("Udate "+e.currentTarget.dataset.update);var t=document.querySelector("#comment-"+e.currentTarget.dataset.update).value;this.updateIssue(e.currentTarget.dataset.update,t)}e.currentTarget.dataset.resolve&&(console.log("Resolve "+e.currentTarget.dataset.resolve),this.resolveIssue(e.currentTarget.dataset.resolve))}},{key:"resolveIssue",value:function(e){(new _).callApi("/issues/resolve/"+e,null,this.componentDidMount)}},{key:"updateIssue",value:function(e,t){var a={address:z,engineer:$,comment:t};(new _).callApi("/issues/update/"+e+"?comment="+JSON.stringify(a),null,this.componentDidMount)}},{key:"componentDidMount",value:function(){var e="/issues/",t=this.props.location.pathname;t.startsWith("/issues/")&&t.length>"/issues/".length&&(e=t),(new _).callApi(e,null,this.passState)}},{key:"render",value:function(){var e=this;if(this.state.success){var t=this.state.data;return r.a.createElement(P.a,null,r.a.createElement(M.a,null,r.a.createElement(U.a,null,r.a.createElement(B.a,null,r.a.createElement(q.a,null,"Issue"),r.a.createElement(q.a,null,"Reported "),r.a.createElement(q.a,null,"Resolved"),r.a.createElement(q.a,null,"Address"),r.a.createElement(q.a,null,"Engineer"),r.a.createElement(q.a,null,"Comment"),r.a.createElement(q.a,null,r.a.createElement(H,{afterReport:this.callUpdate})))),r.a.createElement(L.a,null,t.map((function(t){return r.a.createElement(B.a,{key:"issue-"+t.id},r.a.createElement(q.a,null,t.id),r.a.createElement(q.a,null,new Date(1e3*parseInt(t.report_date)).toLocaleDateString()),r.a.createElement(q.a,null,t.resolve_date>0?new Date(1e3*parseInt(t.resolve_date)).toLocaleDateString():""),r.a.createElement(q.a,null,t.comment.address.city.title," /",t.comment.address.street.title," /",t.comment.address.home.title," /",t.comment.address.flat.title),r.a.createElement(q.a,null,t.comment.engineer.title),r.a.createElement(q.a,null,r.a.createElement(y.a,{label:"\u041a\u043e\u043c\u043c\u0435\u043d\u0442\u0430\u0440\u0438\u0439",id:"comment-"+t.id,defaultValue:t.comment.comment,margin:"normal",variant:"outlined"})),r.a.createElement(q.a,null,r.a.createElement(N.a,{size:"small"},r.a.createElement(O.a,{type:"button",onClick:e.handleSubmit,"data-update":t.id,color:"primary"},"UPDATE"),r.a.createElement(O.a,{type:"button",onClick:e.handleSubmit,"data-resolve":t.id,color:"secondary"},"RESOLVE"))))})))))}return""}}]),t}(r.a.Component),X=a(189),Y=a(201),Z=a(188),ee=a(209),te=a(144),ae=function e(t){Object(o.a)(this,e),this.id=t.id||0,this.slug=t.slug||"root",this.title=t.title||"\u041a\u043e\u0440\u0435\u043d\u044c",this.parentId=t.parentId||0,this.children=t.children||[]},ne=a(95),re=a.n(ne),le=a(145),ie=a(198),oe=a(199),ce=a(200);function se(e){return console.log("I'm TermsListItem : "),console.log(e),0===e.term.children.length?r.a.createElement(me,{title:e.term.title,handleDeleteTerm:e.handleDeleteTerm,id:e.term.id}):r.a.createElement(de,{term:e.term,handleDeleteTerm:e.handleDeleteTerm,id:e.term.id})}function me(e){var t=e.className||"";return r.a.createElement(le.a,{key:"term-"+e.id,button:!0,className:t},r.a.createElement(ie.a,null,r.a.createElement(re.a,null)),r.a.createElement(oe.a,{primary:e.title}),r.a.createElement(O.a,{type:"button",onClick:e.handleDeleteTerm,"data-delete":e.id,color:"primary",variant:"outlined"},"DELETE"))}var ue=Object(E.a)((function(e){return{root:{width:"100%",maxWidth:360,backgroundColor:e.palette.background.paper},nested:{paddingLeft:e.spacing(4)}}}));function de(e){var t=ue(),a=r.a.useState(!0),n=Object(D.a)(a,2),l=n[0];n[1];return[r.a.createElement(me,{title:e.term.title,handleDeleteTerm:e.handleDeleteTerm,id:e.term.id}),r.a.createElement(le.a,{key:"term-"+e.term.id},r.a.createElement(ce.a,{in:l,timeout:"auto",unmountOnExit:!0},r.a.createElement(X.a,{key:"term-"+e.term.id+"-neseted",component:"div",disablePadding:!0},e.term.children.map((function(a){return 0===a.children.length?r.a.createElement(me,{key:"term-"+a.id,className:t.nested,title:a.title,handleDeleteTerm:e.handleDeleteTerm,id:a.id}):r.a.createElement(de,{term:a,handleDeleteTerm:e.handleDeleteTerm,id:a.id})})))))]}a(87);var pe=function(e){function t(e){var a;return Object(o.a)(this,t),a=Object(s.a)(this,Object(m.a)(t).call(this,e)),console.log("I'm constructor"),a.state={success:!1,terms:[],create:new ae({})},console.log("My state is "+JSON.stringify(a.state)),a.updateTimeout=1e4,a.onSubmit=a.onSubmit.bind(Object(u.a)(a)),a.componentDidMount=a.componentDidMount.bind(Object(u.a)(a)),a.onParentSelect=a.onParentSelect.bind(Object(u.a)(a)),a.setInitialState=a.setInitialState.bind(Object(u.a)(a)),a.setInitialState(),a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"createTerm",value:function(e){var t=this,a=g.ApiRequest("/terms/create/");h.a.get(a,{params:{email:h.a.defaults.params.email,password:h.a.defaults.params.password,slug:e.slug.value,title:e.title.value,parent:e.parent.value}}).then((function(e){t.setState({create:new ae({})}),t.componentDidMount()}))}},{key:"deleteTerm",value:function(e){var t=this,a=g.ApiRequest("/terms/delete/");h.a.get(a,{params:{email:h.a.defaults.params.email,password:h.a.defaults.params.password,id:e}}).then((function(e){t.componentDidMount()}))}},{key:"onSubmit",value:function(e){console.log(e.currentTarget.dataset.delete),e.preventDefault(),e.target.create&&this.createTerm(e.target),e.currentTarget.dataset.delete&&this.deleteTerm(e.currentTarget.dataset.delete)}},{key:"onParentSelect",value:function(e){console.log(e.target.value);var t=this.state.create;t.parentId=e.target.value,t.slug=Object(J.slugify)(e.target.selectedOptions.item(0).textContent);var a=t;this.setState({create:a})}},{key:"componentDidMount",value:function(){var e=this;console.log("I'm diMount");var t=g.ApiRequest("/terms/"),a=this.props.location.pathname;a.startsWith("/terms/")&&a.length>"/terms/".length&&(t=g.ApiRequest(a)),h.a.get(t,{params:{email:h.a.defaults.params.email,password:h.a.defaults.params.password}}).then((function(t){console.log("Did mount api result : "+JSON.stringify(t)),e.setState({success:t.data.success,terms:t.data.terms,create:{children:[new ae({})].concat(t.data.terms)}})})).catch((function(e){console.log(e)}))}},{key:"setInitialState",value:function(){}},{key:"componentDidUpdate",value:function(e){console.log(e.location),console.log(this.props.location),this.props.location!==e.location&&this.componentDidMount()}},{key:"render",value:function(){var e=this;console.log("I'm render"),console.log(this.state);var t;return r.a.createElement(b.a,{component:"div"},(t=this.state,console.log("Im arow list func"),console.log(t),!1===t.success?"":r.a.createElement(X.a,null,t.terms.map((function(t){return r.a.createElement(se,{key:t.id,term:t,handleDeleteTerm:e.onSubmit})})))),r.a.createElement(ge,{term:this.state.create,onSubmit:this.onSubmit,onChange:this.onParentSelect}))}}]),t}(r.a.Component),he=Object(E.a)((function(e){return{root:{flexGrow:1},paper:{height:140,width:100},control:{padding:e.spacing(2)}}}));function ge(e){he();return console.log("Form props : "+JSON.stringify(e)),r.a.createElement(b.a,{component:"form",onSubmit:e.onSubmit,variant:"outlined"},r.a.createElement(Y.a,{container:!0,justify:"flex-start",spacing:4},r.a.createElement(Y.a,{key:0,item:!0},r.a.createElement(y.a,{label:"\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435",name:"title",defaultValue:"",variant:"standard"})),r.a.createElement(Y.a,{key:1,item:!0},r.a.createElement(Z.a,null,r.a.createElement(ee.a,{shrink:!0,htmlFor:"parent-id-select"},"\u0420\u043e\u0434\u0438\u0442\u0435\u043b\u044c"),r.a.createElement(F.a,{onChange:e.onChange,inputProps:{name:"parent",id:"parent-id-select"},value:e.term.parentId},r.a.createElement(fe,{term:e.term})))),r.a.createElement(Y.a,{key:2,item:!0},r.a.createElement(O.a,{"data-create":0,type:"submit",variant:"outlined",color:"primary",size:"large"},"SUBMIT"))),r.a.createElement(te.a,{type:"hidden",name:"create",value:0}),r.a.createElement(te.a,{type:"hidden",name:"slug",value:e.term.slug}))}function fe(e){return console.log(e.term),0===e.term.children.length?r.a.createElement("option",{key:e.term.id,value:e.term.id,"data-slug":Object(J.slugify)(e.term.title)},e.term.title):(console.log("ImOptionsList"),console.log(e.term),[e.term.id&&r.a.createElement("option",{key:e.term.id,value:e.term.id},e.term.title),e.term.children.map((function(e){return r.a.createElement(fe,{term:e})}))])}var ve=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(s.a)(this,Object(m.a)(t).call(this,e))).state={success:!1,name:void 0,value:void 0},a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){var e=this;h.a.get(g.ApiRequest("/options/get/roles")).then((function(t){console.log(e.state),e.setState(t.data),console.log(e.state)})).catch((function(e){console.log(e)}))}},{key:"render",value:function(){if(this.state.success){var e=JSON.parse(this.state.value.value).role;return r.a.createElement("div",null,r.a.createElement("p",null,e.id,".",e.name,"[",e.access.toString(),"]"))}return""}}]),t}(r.a.Component),Ee=a(202),be=a(203),ye=a(204),Oe=a(59),we=a(98),Se=a(205),je=a(57),ke=a.n(je),Te=Object(E.a)((function(e){return{root:{flexGrow:1},menuButton:{marginRight:e.spacing(2)},title:{flexGrow:1}}}));function De(e){var t=Te(),a=e.username||"",n=r.a.useState(null),l=Object(D.a)(n,2),i=l[0],o=l[1];return[r.a.createElement(I.a,null,r.a.createElement(Ee.a,{position:"static"},r.a.createElement(be.a,null,r.a.createElement(ye.a,{"aria-controls":"menu-top","aria-hidden":"false","aria-haspopup":"false",onClick:function(e){o(e.currentTarget)},edge:"start",className:t.menuButton,color:"inherit","aria-label":"menu"},r.a.createElement(ke.a,null)),r.a.createElement(Oe.a,{variant:"h6",className:t.title},a,"@ISP.CP"),r.a.createElement(we.a,{id:"menu-top",anchorEl:i,keepMounted:!0,open:Boolean(i),onClose:function(){o(null)}},r.a.createElement(Se.a,{key:"tm-1"},r.a.createElement(O.a,{component:I.b,to:"/",color:"primary",variant:"contained"},"Home")),r.a.createElement(Se.a,{key:"tm-2"},r.a.createElement(O.a,{component:I.b,to:"/issues/",color:"primary",variant:"contained"},"Issues")),r.a.createElement(Se.a,{key:"tm-3"},r.a.createElement(O.a,{component:I.b,to:"/terms/",color:"primary",variant:"contained"},"Terms"))))),r.a.createElement(A.a,{path:"/issues",component:Q}),r.a.createElement(A.a,{path:"/terms",component:pe}),r.a.createElement(A.a,{path:"/options",component:ve}))]}var Ie=function(e){function t(e){var a;Object(o.a)(this,t),a=Object(s.a)(this,Object(m.a)(t).call(this,e));var n=new f;return a.state={user:n},a.handleSubmitLoginForm=a.handleSubmitLoginForm.bind(Object(u.a)(a)),a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"handleSubmitLoginForm",value:function(e){var t=this;e.preventDefault();var a=e.currentTarget,n=f;n.email=a.email.value,n.pass=a.pass.value,h.a.get(g.ApiRequest("/users/login"),{params:{email:n.email,password:n.pass}}).then((function(e){n.id=e.data.item.id||void 0,t.setState({user:n})})).catch((function(e){console.log(e)}))}},{key:"render",value:function(){var e=this.state.user.email,t=this.state.user.pass,a=this.state.user.id||void 0;if(parseInt(a)>0){h.a.defaults.params={email:e,password:t};var n=e.split("@")[0].toUpperCase();return[r.a.createElement(De,{username:n})]}return[r.a.createElement(xe,null),r.a.createElement(T,{onSubmit:this.handleSubmitLoginForm,email:e,pass:t})]}}]),t}(r.a.Component),Ae=Object(E.a)((function(e){return{root:{flexGrow:1},menuButton:{marginRight:e.spacing(2)},title:{flexGrow:1}}}));function xe(e){var t=Ae(),a=e.username||"";return r.a.createElement(Ee.a,{position:"static"},r.a.createElement(be.a,null,r.a.createElement(ye.a,{edge:"start",className:t.menuButton,color:"inherit","aria-label":"menu"},r.a.createElement(ke.a,null)),r.a.createElement(Oe.a,{variant:"h6",className:t.title},a,"@ISP.CP")))}Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var Ce=a(97),Re=Object(Ce.a)({overrides:{MuiButton:{root:{cursor:"pointer"}}}});i.a.render(r.a.createElement(Ie,{theme:Re}),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[113,1,2]]]);
//# sourceMappingURL=main.ee2620d1.chunk.js.map