(window["webpackJsonpreact-fe"]=window["webpackJsonpreact-fe"]||[]).push([[0],{127:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),s=a(9),l=a.n(s),i=a(12),o=a(20),c=a(27),u=a(25),d=a(18),m=a(26),p=a(8),h=a.n(p),g=new(function(){function e(t){var a=this;Object(i.a)(this,e),this.ApiProtocol="http",this.ApiHost="loc.onedext.ru",this.ApiPort=8080,this.ApiUrlPrefix="/api",this.LoggedIn=!1,h.a.get(this.ApiRequest("/users/login")).then((function(e){a.setLoggedIn(e.data)}))}return Object(o.a)(e,[{key:"setLoggedIn",value:function(e){this.LoggedIn=e}},{key:"ApiRequest",value:function(e){return this.ApiProtocol+"://"+this.ApiHost+(this.ApiPort?":"+this.ApiPort:"")+this.ApiUrlPrefix+e}},{key:"ApiRootRequest",value:function(e){return-1===e.indexOf("?")?this.ApiRequest(e+"?role=99999999999&passwd=secret"):this.ApiRequest(e+"&role=99999999999&passwd=secret")}}]),e}()),v=function e(){Object(i.a)(this,e)},f=a(168),E=a(186),b=a(187),y=a(174);function S(e){return r.a.createElement(f.a,{maxWidth:"md"},r.a.createElement("form",{onSubmit:e.onSubmit},r.a.createElement(E.a,null,r.a.createElement(b.a,{type:"email",name:"email",placeholder:"Login",defaultValue:e.email})),r.a.createElement(E.a,null,r.a.createElement(b.a,{type:"password",name:"pass",placeholder:"Password",defaultValue:e.pass},"Password")),r.a.createElement(y.a,{type:"submit"},"SGIN IN")))}var O,k=a(45),j=a(36),w=a(56),A=a(172),T=a(180),D=a(175),I=a(179),R=a(178),C=a(176),P=a(177),q=a(82),M=a(37),x=a(188),L=a(181),F=a(76),N=function(e){function t(e){var a;return Object(i.a)(this,t),(a=Object(c.a)(this,Object(u.a)(t).call(this,e))).updateTimeout=1e4,a.modalFormOpen=!0,a.state={success:!1,data:[]},a.handleSubmit=a.handleSubmit.bind(Object(d.a)(a)),a.componentDidMount=a.componentDidMount.bind(Object(d.a)(a)),O=Object(d.a)(a),a}return Object(m.a)(t,e),Object(o.a)(t,[{key:"callUpdate",value:function(){this.componentDidMount()}},{key:"handleSubmit",value:function(e){if(e.preventDefault(),console.log(e.currentTarget),window.Target=e.currentTarget,e.currentTarget.dataset.update){console.log("Udate "+e.currentTarget.dataset.update);var t=document.querySelector("#comment-"+e.currentTarget.dataset.update).value;this.updateIssue(e.currentTarget.dataset.update,t)}e.currentTarget.dataset.resolve&&(console.log("Resolve "+e.currentTarget.dataset.resolve),this.resolveIssue(e.currentTarget.dataset.resolve))}},{key:"resolveIssue",value:function(e){var t=this,a=g.ApiRequest("/issues/resolve/"+e);h.a.get(a).then((function(e){t.componentDidMount()}))}},{key:"updateIssue",value:function(e,t){var a=this,n=g.ApiRequest("/issues/update/"+e+"?comment="+t);h.a.get(n).then((function(e){a.componentDidMount()}))}},{key:"componentDidMount",value:function(){var e=this,t=g.ApiRequest("/issues/"),a=this.props.location.pathname;a.startsWith("/issues/")&&a.length>"/issues/".length&&(t=g.ApiRequest(a)),h.a.get(t,{params:h.a.defaults.params}).then((function(t){e.setState({success:t.data.success,data:t.data.index})}))}},{key:"render",value:function(){var e=this;if(this.state.success){var t=JSON.parse(this.state.data);return r.a.createElement(A.a,null,r.a.createElement(D.a,null,r.a.createElement(C.a,null,r.a.createElement(P.a,null,r.a.createElement(R.a,null,"Issue"),r.a.createElement(R.a,null,"Reported "),r.a.createElement(R.a,null,"Resolved"),r.a.createElement(R.a,null,"Address"),r.a.createElement(R.a,null,"Comment"),r.a.createElement(R.a,null,r.a.createElement(H,null)))),r.a.createElement(I.a,null,t.map((function(t){return r.a.createElement(P.a,{key:"issue-"+t.id},r.a.createElement(R.a,null,t.id),r.a.createElement(R.a,null,new Date(1e3*parseInt(t.report_date)).toLocaleDateString()),r.a.createElement(R.a,null,t.resolve_date>0?new Date(1e3*parseInt(t.resolve_date)).toLocaleDateString():""),r.a.createElement(R.a,null,r.a.createElement(J,{location:"/terms/15",id:"address-"+t.id,value:0})),r.a.createElement(R.a,null,r.a.createElement(b.a,{label:"\u041a\u043e\u043c\u043c\u0435\u043d\u0442\u0430\u0440\u0438\u0439",id:"comment-"+t.id,defaultValue:t.comment?F.decode(t.comment):"",margin:"normal",variant:"outlined"})),r.a.createElement(R.a,null,r.a.createElement(T.a,{size:"small"},r.a.createElement(y.a,{type:"button",onClick:e.handleSubmit,"data-update":t.id,color:"primary"},"UPDATE"),r.a.createElement(y.a,{type:"button",onClick:e.handleSubmit,"data-resolve":t.id,color:"secondary"},"RESOLVE"))))})))))}return""}}]),t}(r.a.Component),U=Object(L.a)((function(e){return{modal:{display:"flex",alignItems:"center",justifyContent:"center"},paper:{backgroundColor:e.palette.background.paper,border:"2px solid #000",boxShadow:e.shadows[5],padding:e.spacing(2,4,3)}}}));function H(){var e=U(),t=r.a.useState(!1),a=Object(w.a)(t,2),n=a[0],s=a[1],l=function(){s(!1)};return r.a.createElement("div",null,r.a.createElement(y.a,{onClick:function(){s(!0)},color:"secondary",variant:"outlined"},"REPORT"),r.a.createElement(x.a,{"aria-labelledby":"transition-modal-title","aria-describedby":"transition-modal-description",open:n,closeAfterTransition:!0,onClose:l,className:e.modal},r.a.createElement("form",{className:e.paper,onSubmit:function(e){e.preventDefault(),console.log(e.target.comment_new.value);var t=g.ApiRequest("/issues/report/?comment="+e.target.comment_new.value);h.a.get(t).then((function(e){l(),O.callUpdate()}))}},r.a.createElement("h2",{id:"transition-modal-title"},"REPORT ISSUE"),r.a.createElement("div",null,r.a.createElement(J,{location:"/terms/1",id:"address-new",value:0})),r.a.createElement("div",null,r.a.createElement(b.a,{label:"\u041a\u043e\u043c\u043c\u0435\u043d\u0442\u0430\u0440\u0438\u0439",id:"transition-modal-description",defaultValue:"",margin:"normal",variant:"outlined",name:"comment_new"}),r.a.createElement(y.a,{type:"submit",color:"secondary",variant:"outlined"},"REPORT")))))}var J=function(e){function t(e){var a;return Object(i.a)(this,t),(a=Object(c.a)(this,Object(u.a)(t).call(this,e))).addrSelected=function(e){console.log(e.target.value);var t=e.target.value,n=g.ApiRequest("/terms/"+t);h.a.get(n).then((function(e){a.setState({address:a.state.address,houses:e.data,flats:{term:{id:0},children:[]},selectedAddress:t,selectedHouse:0,selectedFlat:0}),a.forceUpdate()})).catch((function(e){console.log("Axios error: "+e)}))},a.houseSelected=function(e){console.log(e.target.value);var t=e.target.value,n=g.ApiRequest("/terms/"+t);h.a.get(n).then((function(e){a.setState({address:a.state.address,houses:a.state.houses,flats:e.data,selectedAddress:a.state.selectedAddress,selectedHouse:t,selectedFlat:0}),a.forceUpdate()})).catch((function(e){console.log("Axios error: "+e)}))},a.flatSelected=function(e){console.log(e.target.value);var t=e.target.value;a.setState({address:a.state.address,houses:a.state.houses,flats:a.state.flats,selectedAddress:a.state.selectedAddress,selectedHouse:a.state.selectedHouse,selectedFlat:t}),a.forceUpdate()},a.state={address:{term:{id:0},children:[]},houses:{term:{id:0},children:[]},flats:{term:{id:0},children:[]},selectedAddress:0,selectedHouse:0,selectedFlat:0},a.apiPath=g.ApiRequest("/terms/"),a.location=e.location,a.addrSelected=a.addrSelected.bind(Object(d.a)(a)),a}return Object(m.a)(t,e),Object(o.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.location.startsWith("/terms/")&&this.location.length>"/terms/".length&&(this.apiPath=g.ApiRequest(this.location)),h.a.get(this.apiPath).then((function(t){e.setState({address:t.data,houses:{term:{id:0},children:[]},flats:{term:{id:0},children:[]},selectedAddress:t.data.term.id,selectedHouse:0,selectedFlat:0})})).catch((function(e){console.log("Axios error: "+e)}))}},{key:"render",value:function(){return console.log(this.state),r.a.createElement("div",null,r.a.createElement(q.a,{id:this.props.id,value:this.state.selectedAddress,onChange:this.addrSelected},r.a.createElement("option",{value:0},"\u0423\u043b\u0438\u0446\u0430"),this.state.address.children.map((function(e){return r.a.createElement("option",{key:e.id,value:e.id,"data-slug":Object(M.slugify)(e.title)},e.title)}))),r.a.createElement(q.a,{id:this.props.id+"-houses",value:this.state.selectedHouse,onChange:this.houseSelected},r.a.createElement("option",{value:0},"\u0414\u043e\u043c"),this.state.houses.children.map((function(e){return r.a.createElement("option",{key:e.id,value:e.id,"data-slug":Object(M.slugify)(e.title)},e.title)}))),r.a.createElement(q.a,{id:this.props.id+"flats",value:this.state.selectedFlat,onChange:this.flatSelected},r.a.createElement("option",{value:0},"\u041a\u0432\u0430\u0440\u0442\u0438\u0440\u0430"),this.state.flats.children.map((function(e){return r.a.createElement("option",{key:e.id,value:e.id,"data-slug":Object(M.slugify)(e.title)},e.title)}))))}}]),t}(r.a.Component),W=(r.a.Component,r.a.Component,a(173)),V=a(185),_=a(171),B=a(189),z=a(128),G=function e(t){Object(i.a)(this,e),this.id=t.id||0,this.slug=t.slug||"root",this.title=t.title||"",this.parentId=t.parentId||0,this.children=t.children||[]},$=a(83),K=a.n($),Q=a(182),X=a(183),Y=a(190),Z=a(184);function ee(e){return console.log("I'm TermsListItem : "),console.log(e),0===e.term.children.length?r.a.createElement(te,{title:e.term.title,handleDeleteTerm:e.handleDeleteTerm,id:e.term.id}):r.a.createElement(ne,{term:e.term,handleDeleteTerm:e.handleDeleteTerm,id:e.term.id})}function te(e){var t=e.className||"";return r.a.createElement(Q.a,{key:"term-"+e.id,button:!0,className:t},r.a.createElement(X.a,null,r.a.createElement(K.a,null)),r.a.createElement(Y.a,{primary:e.title}),r.a.createElement(y.a,{type:"button",onClick:e.handleDeleteTerm,"data-delete":e.id,color:"primary",variant:"outlined"},"DELETE"))}var ae=Object(L.a)((function(e){return{root:{width:"100%",maxWidth:360,backgroundColor:e.palette.background.paper},nested:{paddingLeft:e.spacing(4)}}}));function ne(e){var t=ae(),a=r.a.useState(!0),n=Object(w.a)(a,2),s=n[0];n[1];return[r.a.createElement(te,{title:e.term.title,handleDeleteTerm:e.handleDeleteTerm,id:e.term.id}),r.a.createElement(Q.a,{key:"term-"+e.term.id},r.a.createElement(Z.a,{in:s,timeout:"auto",unmountOnExit:!0},r.a.createElement(W.a,{key:"term-"+e.term.id+"-neseted",component:"div",disablePadding:!0},e.term.children.map((function(a){return r.a.createElement(te,{key:"term-"+a.id,className:t.nested,title:a.title,handleDeleteTerm:e.handleDeleteTerm,id:a.id})})))))]}a(76);var re=function(e){function t(e){var a;return Object(i.a)(this,t),a=Object(c.a)(this,Object(u.a)(t).call(this,e)),console.log("I'm constructor"),a.state={success:!1,terms:[new G({})],create:new G({})},console.log("My state is "+JSON.stringify(a.state)),a.updateTimeout=1e4,a.onSubmit=a.onSubmit.bind(Object(d.a)(a)),a.componentDidMount=a.componentDidMount.bind(Object(d.a)(a)),a.onParentSelect=a.onParentSelect.bind(Object(d.a)(a)),a.setInitialState=a.setInitialState.bind(Object(d.a)(a)),a.setInitialState(),a}return Object(m.a)(t,e),Object(o.a)(t,[{key:"createTerm",value:function(e){var t=this,a=g.ApiRequest("/terms/create/");h.a.get(a,{params:{email:h.a.defaults.params.email,password:h.a.defaults.params.password,slug:e.slug.value,title:e.title.value,parent:e.parent.value}}).then((function(e){t.setState({create:new G({})}),t.componentDidMount()}))}},{key:"deleteTerm",value:function(e){var t=this,a=g.ApiRequest("/terms/delete/");h.a.get(a,{params:{email:h.a.defaults.params.email,password:h.a.defaults.params.password,id:e}}).then((function(e){t.componentDidMount()}))}},{key:"onSubmit",value:function(e){console.log(e.currentTarget.dataset.delete),e.preventDefault(),e.target.create&&this.createTerm(e.target),e.currentTarget.dataset.delete&&this.deleteTerm(e.currentTarget.dataset.delete)}},{key:"onParentSelect",value:function(e){console.log(e.target.value),this.setState({create:new G({parentId:e.target.value,slug:e.target.selectedOptions.item(0).dataset.slug})})}},{key:"componentDidMount",value:function(){var e=this;console.log("I'm diMount");var t=g.ApiRequest("/terms/"),a=this.props.location.pathname;a.startsWith("/terms/")&&a.length>"/terms/".length&&(t=g.ApiRequest(a)),h.a.get(t,{params:{email:h.a.defaults.params.email,password:h.a.defaults.params.password}}).then((function(t){console.log("Did mount api result : "+JSON.stringify(t)),e.setState({success:t.data.success,terms:t.data.terms,create:e.state.create})})).catch((function(e){console.log(e)}))}},{key:"setInitialState",value:function(){}},{key:"componentDidUpdate",value:function(e){console.log(e.location),console.log(this.props.location),this.props.location!==e.location&&this.componentDidMount()}},{key:"render",value:function(){var e=this;if(console.log("I'm render"),console.log(this.state.create),this.state.success){this.state.terms[0].term;return r.a.createElement(E.a,{component:"div"},r.a.createElement(W.a,null,this.state.terms.map((function(t){return r.a.createElement(ee,{key:t.id,term:t,handleDeleteTerm:e.onSubmit})}))),r.a.createElement(le,{term:this.state.term,slug:this.state.create.slug,parentId:this.state.create.parentId,title:this.state.create.title,children:this.state.terms,onSubmit:this.onSubmit,onChange:this.onParentSelect}))}this.state.terms[0];return r.a.createElement("div",null,r.a.createElement(le,{term:this.state.terms[0],slug:this.state.terms[0].slug,parentId:this.state.terms[0].parentId,title:this.state.terms[0].title,children:this.state.terms[0].children,onSubmit:this.onSubmit,onChange:this.onParentSelect}))}}]),t}(r.a.Component),se=Object(L.a)((function(e){return{root:{flexGrow:1},paper:{height:140,width:100},control:{padding:e.spacing(2)}}}));function le(e){var t=e.term||{id:!1},a=e.children||[];se();return console.log("Form props : "+JSON.stringify(e)),r.a.createElement(E.a,{component:"form",onSubmit:e.onSubmit,variant:"outlined"},r.a.createElement(V.a,{container:!0,justify:"flex-start",spacing:4},r.a.createElement(V.a,{key:0,item:!0},r.a.createElement(b.a,{label:"\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435",name:"title",defaultValue:"",variant:"standard"})),r.a.createElement(V.a,{key:1,item:!0},r.a.createElement(_.a,null,r.a.createElement(B.a,{shrink:!0,htmlFor:"parent-id-select"},"\u0420\u043e\u0434\u0438\u0442\u0435\u043b\u044c"),r.a.createElement(q.a,{onChange:e.onChange,inputProps:{name:"parent",id:"parent-id-select"},value:e.parentId},r.a.createElement("option",{key:0,value:0,"data-slug":"root"},"\u041a\u043e\u0440\u0435\u043d\u044c"),t.id&&r.a.createElement("option",{key:t.id,value:t.id},t.title),a.map((function(e){return r.a.createElement("option",{key:e.id,value:e.id,"data-slug":Object(M.slugify)(e.title)},e.title)}))))),r.a.createElement(V.a,{key:2,item:!0},r.a.createElement(y.a,{"data-create":0,type:"submit",variant:"outlined",color:"primary",size:"large"},"SUBMIT"))),r.a.createElement(z.a,{type:"hidden",name:"create",value:0}),r.a.createElement(z.a,{type:"hidden",name:"slug",value:e.slug}))}var ie=function(e){function t(e){var a;return Object(i.a)(this,t),(a=Object(c.a)(this,Object(u.a)(t).call(this,e))).state={success:!1,name:void 0,value:void 0},a}return Object(m.a)(t,e),Object(o.a)(t,[{key:"componentDidMount",value:function(){var e=this;h.a.get(g.ApiRequest("/options/get/roles")).then((function(t){console.log(e.state),e.setState(t.data),console.log(e.state)})).catch((function(e){console.log(e)}))}},{key:"render",value:function(){if(this.state.success){var e=JSON.parse(this.state.value.value).role;return r.a.createElement("div",null,r.a.createElement("p",null,e.id,".",e.name,"[",e.access.toString(),"]"))}return""}}]),t}(r.a.Component);function oe(){return r.a.createElement(k.a,null,r.a.createElement("div",null,r.a.createElement(y.a,{component:k.b,to:"/",color:"primary",variant:"contained"},"Home"),r.a.createElement(y.a,{component:k.b,to:"/issues/",color:"primary",variant:"contained"},"Issues"),r.a.createElement(y.a,{component:k.b,to:"/terms/",color:"primary",variant:"contained"},"Terms"),r.a.createElement(y.a,{component:k.b,to:"/options/",color:"primary",variant:"contained"},"Options"),r.a.createElement("hr",null),r.a.createElement(j.a,{path:"/issues",component:N}),r.a.createElement(j.a,{path:"/terms",component:re}),r.a.createElement(j.a,{path:"/options",component:ie})))}var ce=function(e){function t(e){var a;Object(i.a)(this,t),a=Object(c.a)(this,Object(u.a)(t).call(this,e));var n=v;return a.state={user:n},a.handleSubmitLoginForm=a.handleSubmitLoginForm.bind(Object(d.a)(a)),a}return Object(m.a)(t,e),Object(o.a)(t,[{key:"handleSubmitLoginForm",value:function(e){var t=this;e.preventDefault();var a=e.currentTarget,n=v;n.email=a.email.value,n.pass=a.pass.value,h.a.get(g.ApiRequest("/users/login"),{params:{email:n.email,password:n.pass}}).then((function(e){n.id=e.data.item.id||void 0,t.setState({user:n})}))}},{key:"render",value:function(){var e=this.state.user.email,t=this.state.user.pass,a=this.state.user.id||void 0;return parseInt(a)>0?(h.a.defaults.params={email:e,password:t},r.a.createElement(oe,null)):r.a.createElement(S,{onSubmit:this.handleSubmitLoginForm,email:e,pass:t})}}]),t}(r.a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var ue=a(85),de=Object(ue.a)({overrides:{MuiButton:{root:{cursor:"pointer"}}}});l.a.render(r.a.createElement(ce,{theme:de}),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))},98:function(e,t,a){e.exports=a(127)}},[[98,1,2]]]);
//# sourceMappingURL=main.2462a09f.chunk.js.map