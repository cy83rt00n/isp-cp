(window["webpackJsonpreact-fe"]=window["webpackJsonpreact-fe"]||[]).push([[0],{110:function(e,t,a){e.exports=a(138)},138:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),l=a(9),s=a.n(l),i=a(15),o=a(20),c=a(27),u=a(25),d=a(18),m=a(26),p=a(8),h=a.n(p),g=new(function(){function e(t){var a=this;Object(i.a)(this,e),this.ApiProtocol="http",this.ApiHost="ispcp.onedext.ru",this.ApiPort=8080,this.ApiUrlPrefix="/api",this.LoggedIn=!1,h.a.get(this.ApiRequest("/users/login")).then((function(e){a.setLoggedIn(e.data)}))}return Object(o.a)(e,[{key:"setLoggedIn",value:function(e){this.LoggedIn=e}},{key:"ApiRequest",value:function(e){return this.ApiProtocol+"://"+this.ApiHost+(this.ApiPort?":"+this.ApiPort:"")+this.ApiUrlPrefix+e}},{key:"ApiRootRequest",value:function(e){return-1===e.indexOf("?")?this.ApiRequest(e+"?role=99999999999&passwd=secret"):this.ApiRequest(e+"&role=99999999999&passwd=secret")}}]),e}()),f=function e(){Object(i.a)(this,e)},v=a(182),E=a(180),b=a(204),y=a(205),S=a(189),O=a(184),k=a(185),j=a(188),w=Object(E.a)({card:{minWidth:275},bullet:{display:"inline-block",margin:"0 2px",transform:"scale(0.8)"},title:{fontSize:14},pos:{marginBottom:12},cardContainer:{marginTop:"1.5em"}});function A(e){var t=w();return r.a.createElement(v.a,{className:t.cardContainer,maxWidth:"sm"},r.a.createElement(O.a,{className:t.card,maxWidth:"md",component:"form",onSubmit:e.onSubmit},r.a.createElement(k.a,null,r.a.createElement(b.a,{component:"div"},r.a.createElement(y.a,{type:"email",name:"email",placeholder:"Login",defaultValue:e.email})),r.a.createElement(b.a,{component:"div"},r.a.createElement(y.a,{type:"password",name:"pass",placeholder:"Password",defaultValue:e.pass},"Password"))),r.a.createElement(j.a,null,r.a.createElement(S.a,{type:"submit"},"SGIN IN"))))}var T,I=a(43),D=a(51),R=a(36),C=a(94),P=a(195),x=a(190),q=a(194),M=a(193),N=a(191),L=a(192),F=a(89),U=a(37),B=a(206),H=a(83),W=function(e){function t(e){var a;return Object(i.a)(this,t),(a=Object(c.a)(this,Object(u.a)(t).call(this,e))).updateTimeout=1e4,a.modalFormOpen=!0,a.state={success:!1,data:[]},a.handleSubmit=a.handleSubmit.bind(Object(d.a)(a)),a.componentDidMount=a.componentDidMount.bind(Object(d.a)(a)),T=Object(d.a)(a),a}return Object(m.a)(t,e),Object(o.a)(t,[{key:"callUpdate",value:function(){this.componentDidMount()}},{key:"handleSubmit",value:function(e){if(e.preventDefault(),console.log(e.currentTarget),window.Target=e.currentTarget,e.currentTarget.dataset.update){console.log("Udate "+e.currentTarget.dataset.update);var t=document.querySelector("#comment-"+e.currentTarget.dataset.update).value;this.updateIssue(e.currentTarget.dataset.update,t)}e.currentTarget.dataset.resolve&&(console.log("Resolve "+e.currentTarget.dataset.resolve),this.resolveIssue(e.currentTarget.dataset.resolve))}},{key:"resolveIssue",value:function(e){var t=this,a=g.ApiRequest("/issues/resolve/"+e);h.a.get(a).then((function(e){t.componentDidMount()}))}},{key:"updateIssue",value:function(e,t){var a=this,n=g.ApiRequest("/issues/update/"+e+"?comment="+t);h.a.get(n).then((function(e){a.componentDidMount()}))}},{key:"componentDidMount",value:function(){var e=this,t=g.ApiRequest("/issues/"),a=this.props.location.pathname;a.startsWith("/issues/")&&a.length>"/issues/".length&&(t=g.ApiRequest(a)),h.a.get(t,{params:h.a.defaults.params}).then((function(t){e.setState({success:t.data.success,data:t.data.index})}))}},{key:"render",value:function(){var e=this;if(this.state.success){var t=JSON.parse(this.state.data);return r.a.createElement(C.a,null,r.a.createElement(x.a,null,r.a.createElement(N.a,null,r.a.createElement(L.a,null,r.a.createElement(M.a,null,"Issue"),r.a.createElement(M.a,null,"Reported "),r.a.createElement(M.a,null,"Resolved"),r.a.createElement(M.a,null,"Address"),r.a.createElement(M.a,null,"Comment"),r.a.createElement(M.a,null,r.a.createElement(G,null)))),r.a.createElement(q.a,null,t.map((function(t){return r.a.createElement(L.a,{key:"issue-"+t.id},r.a.createElement(M.a,null,t.id),r.a.createElement(M.a,null,new Date(1e3*parseInt(t.report_date)).toLocaleDateString()),r.a.createElement(M.a,null,t.resolve_date>0?new Date(1e3*parseInt(t.resolve_date)).toLocaleDateString():""),r.a.createElement(M.a,null,r.a.createElement(V,{location:"/terms/15",id:"address-"+t.id,value:0})),r.a.createElement(M.a,null,r.a.createElement(y.a,{label:"\u041a\u043e\u043c\u043c\u0435\u043d\u0442\u0430\u0440\u0438\u0439",id:"comment-"+t.id,defaultValue:t.comment?H.decode(t.comment):"",margin:"normal",variant:"outlined"})),r.a.createElement(M.a,null,r.a.createElement(P.a,{size:"small"},r.a.createElement(S.a,{type:"button",onClick:e.handleSubmit,"data-update":t.id,color:"primary"},"UPDATE"),r.a.createElement(S.a,{type:"button",onClick:e.handleSubmit,"data-resolve":t.id,color:"secondary"},"RESOLVE"))))})))))}return""}}]),t}(r.a.Component),J=Object(E.a)((function(e){return{modal:{display:"flex",alignItems:"center",justifyContent:"center"},paper:{backgroundColor:e.palette.background.paper,border:"2px solid #000",boxShadow:e.shadows[5],padding:e.spacing(2,4,3)}}}));function G(){var e=J(),t=r.a.useState(!1),a=Object(I.a)(t,2),n=a[0],l=a[1],s=function(){l(!1)};return r.a.createElement("div",null,r.a.createElement(S.a,{onClick:function(){l(!0)},color:"secondary",variant:"outlined"},"REPORT"),r.a.createElement(B.a,{"aria-labelledby":"transition-modal-title","aria-describedby":"transition-modal-description",open:n,closeAfterTransition:!0,onClose:s,className:e.modal},r.a.createElement("form",{className:e.paper,onSubmit:function(e){e.preventDefault(),console.log(e.target.comment_new.value);var t=g.ApiRequest("/issues/report/?comment="+e.target.comment_new.value);h.a.get(t).then((function(e){s(),T.callUpdate()}))}},r.a.createElement("h2",{id:"transition-modal-title"},"REPORT ISSUE"),r.a.createElement("div",null,r.a.createElement(V,{location:"/terms/1",id:"address-new",value:0})),r.a.createElement("div",null,r.a.createElement(y.a,{label:"\u041a\u043e\u043c\u043c\u0435\u043d\u0442\u0430\u0440\u0438\u0439",id:"transition-modal-description",defaultValue:"",margin:"normal",variant:"outlined",name:"comment_new"}),r.a.createElement(S.a,{type:"submit",color:"secondary",variant:"outlined"},"REPORT")))))}var V=function(e){function t(e){var a;return Object(i.a)(this,t),(a=Object(c.a)(this,Object(u.a)(t).call(this,e))).addrSelected=function(e){console.log(e.target.value);var t=e.target.value,n=g.ApiRequest("/terms/"+t);h.a.get(n).then((function(e){a.setState({address:a.state.address,houses:e.data,flats:{term:{id:0},children:[]},selectedAddress:t,selectedHouse:0,selectedFlat:0}),a.forceUpdate()})).catch((function(e){console.log("Axios error: "+e)}))},a.houseSelected=function(e){console.log(e.target.value);var t=e.target.value,n=g.ApiRequest("/terms/"+t);h.a.get(n).then((function(e){a.setState({address:a.state.address,houses:a.state.houses,flats:e.data,selectedAddress:a.state.selectedAddress,selectedHouse:t,selectedFlat:0}),a.forceUpdate()})).catch((function(e){console.log("Axios error: "+e)}))},a.flatSelected=function(e){console.log(e.target.value);var t=e.target.value;a.setState({address:a.state.address,houses:a.state.houses,flats:a.state.flats,selectedAddress:a.state.selectedAddress,selectedHouse:a.state.selectedHouse,selectedFlat:t}),a.forceUpdate()},a.state={address:{term:{id:0},children:[]},houses:{term:{id:0},children:[]},flats:{term:{id:0},children:[]},selectedAddress:0,selectedHouse:0,selectedFlat:0},a.apiPath=g.ApiRequest("/terms/"),a.location=e.location,a.addrSelected=a.addrSelected.bind(Object(d.a)(a)),a}return Object(m.a)(t,e),Object(o.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.location.startsWith("/terms/")&&this.location.length>"/terms/".length&&(this.apiPath=g.ApiRequest(this.location)),h.a.get(this.apiPath).then((function(t){e.setState({address:t.data,houses:{term:{id:0},children:[]},flats:{term:{id:0},children:[]},selectedAddress:t.data.term.id,selectedHouse:0,selectedFlat:0})})).catch((function(e){console.log("Axios error: "+e)}))}},{key:"render",value:function(){return console.log(this.state),r.a.createElement("div",null,r.a.createElement(F.a,{id:this.props.id,value:this.state.selectedAddress,onChange:this.addrSelected},r.a.createElement("option",{value:0},"\u0423\u043b\u0438\u0446\u0430"),this.state.address.children.map((function(e){return r.a.createElement("option",{key:e.id,value:e.id,"data-slug":Object(U.slugify)(e.title)},e.title)}))),r.a.createElement(F.a,{id:this.props.id+"-houses",value:this.state.selectedHouse,onChange:this.houseSelected},r.a.createElement("option",{value:0},"\u0414\u043e\u043c"),this.state.houses.children.map((function(e){return r.a.createElement("option",{key:e.id,value:e.id,"data-slug":Object(U.slugify)(e.title)},e.title)}))),r.a.createElement(F.a,{id:this.props.id+"flats",value:this.state.selectedFlat,onChange:this.flatSelected},r.a.createElement("option",{value:0},"\u041a\u0432\u0430\u0440\u0442\u0438\u0440\u0430"),this.state.flats.children.map((function(e){return r.a.createElement("option",{key:e.id,value:e.id,"data-slug":Object(U.slugify)(e.title)},e.title)}))))}}]),t}(r.a.Component),_=(r.a.Component,r.a.Component,a(187)),z=a(199),$=a(186),K=a(207),Q=a(139),X=function e(t){Object(i.a)(this,e),this.id=t.id||0,this.slug=t.slug||"root",this.title=t.title||"",this.parentId=t.parentId||0,this.children=t.children||[]},Y=a(90),Z=a.n(Y),ee=a(140),te=a(196),ae=a(197),ne=a(198);function re(e){return console.log("I'm TermsListItem : "),console.log(e),0===e.term.children.length?r.a.createElement(le,{title:e.term.title,handleDeleteTerm:e.handleDeleteTerm,id:e.term.id}):r.a.createElement(ie,{term:e.term,handleDeleteTerm:e.handleDeleteTerm,id:e.term.id})}function le(e){var t=e.className||"";return r.a.createElement(ee.a,{key:"term-"+e.id,button:!0,className:t},r.a.createElement(te.a,null,r.a.createElement(Z.a,null)),r.a.createElement(ae.a,{primary:e.title}),r.a.createElement(S.a,{type:"button",onClick:e.handleDeleteTerm,"data-delete":e.id,color:"primary",variant:"outlined"},"DELETE"))}var se=Object(E.a)((function(e){return{root:{width:"100%",maxWidth:360,backgroundColor:e.palette.background.paper},nested:{paddingLeft:e.spacing(4)}}}));function ie(e){var t=se(),a=r.a.useState(!0),n=Object(I.a)(a,2),l=n[0];n[1];return[r.a.createElement(le,{title:e.term.title,handleDeleteTerm:e.handleDeleteTerm,id:e.term.id}),r.a.createElement(ee.a,{key:"term-"+e.term.id},r.a.createElement(ne.a,{in:l,timeout:"auto",unmountOnExit:!0},r.a.createElement(_.a,{key:"term-"+e.term.id+"-neseted",component:"div",disablePadding:!0},e.term.children.map((function(a){return r.a.createElement(le,{key:"term-"+a.id,className:t.nested,title:a.title,handleDeleteTerm:e.handleDeleteTerm,id:a.id})})))))]}a(83);var oe=function(e){function t(e){var a;return Object(i.a)(this,t),a=Object(c.a)(this,Object(u.a)(t).call(this,e)),console.log("I'm constructor"),a.state={success:!1,terms:[new X({})],create:new X({})},console.log("My state is "+JSON.stringify(a.state)),a.updateTimeout=1e4,a.onSubmit=a.onSubmit.bind(Object(d.a)(a)),a.componentDidMount=a.componentDidMount.bind(Object(d.a)(a)),a.onParentSelect=a.onParentSelect.bind(Object(d.a)(a)),a.setInitialState=a.setInitialState.bind(Object(d.a)(a)),a.setInitialState(),a}return Object(m.a)(t,e),Object(o.a)(t,[{key:"createTerm",value:function(e){var t=this,a=g.ApiRequest("/terms/create/");h.a.get(a,{params:{email:h.a.defaults.params.email,password:h.a.defaults.params.password,slug:e.slug.value,title:e.title.value,parent:e.parent.value}}).then((function(e){t.setState({create:new X({})}),t.componentDidMount()}))}},{key:"deleteTerm",value:function(e){var t=this,a=g.ApiRequest("/terms/delete/");h.a.get(a,{params:{email:h.a.defaults.params.email,password:h.a.defaults.params.password,id:e}}).then((function(e){t.componentDidMount()}))}},{key:"onSubmit",value:function(e){console.log(e.currentTarget.dataset.delete),e.preventDefault(),e.target.create&&this.createTerm(e.target),e.currentTarget.dataset.delete&&this.deleteTerm(e.currentTarget.dataset.delete)}},{key:"onParentSelect",value:function(e){console.log(e.target.value),this.setState({create:new X({parentId:e.target.value,slug:e.target.selectedOptions.item(0).dataset.slug})})}},{key:"componentDidMount",value:function(){var e=this;console.log("I'm diMount");var t=g.ApiRequest("/terms/"),a=this.props.location.pathname;a.startsWith("/terms/")&&a.length>"/terms/".length&&(t=g.ApiRequest(a)),h.a.get(t,{params:{email:h.a.defaults.params.email,password:h.a.defaults.params.password}}).then((function(t){console.log("Did mount api result : "+JSON.stringify(t)),e.setState({success:t.data.success,terms:t.data.terms,create:e.state.create})})).catch((function(e){console.log(e)}))}},{key:"setInitialState",value:function(){}},{key:"componentDidUpdate",value:function(e){console.log(e.location),console.log(this.props.location),this.props.location!==e.location&&this.componentDidMount()}},{key:"render",value:function(){var e=this;if(console.log("I'm render"),console.log(this.state.create),this.state.success){this.state.terms[0].term;return r.a.createElement(b.a,{component:"div"},r.a.createElement(_.a,null,this.state.terms.map((function(t){return r.a.createElement(re,{key:t.id,term:t,handleDeleteTerm:e.onSubmit})}))),r.a.createElement(ue,{term:this.state.term,slug:this.state.create.slug,parentId:this.state.create.parentId,title:this.state.create.title,children:this.state.terms,onSubmit:this.onSubmit,onChange:this.onParentSelect}))}this.state.terms[0];return r.a.createElement("div",null,r.a.createElement(ue,{term:this.state.terms[0],slug:this.state.terms[0].slug,parentId:this.state.terms[0].parentId,title:this.state.terms[0].title,children:this.state.terms[0].children,onSubmit:this.onSubmit,onChange:this.onParentSelect}))}}]),t}(r.a.Component),ce=Object(E.a)((function(e){return{root:{flexGrow:1},paper:{height:140,width:100},control:{padding:e.spacing(2)}}}));function ue(e){var t=e.term||{id:!1},a=e.children||[];ce();return console.log("Form props : "+JSON.stringify(e)),r.a.createElement(b.a,{component:"form",onSubmit:e.onSubmit,variant:"outlined"},r.a.createElement(z.a,{container:!0,justify:"flex-start",spacing:4},r.a.createElement(z.a,{key:0,item:!0},r.a.createElement(y.a,{label:"\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435",name:"title",defaultValue:"",variant:"standard"})),r.a.createElement(z.a,{key:1,item:!0},r.a.createElement($.a,null,r.a.createElement(K.a,{shrink:!0,htmlFor:"parent-id-select"},"\u0420\u043e\u0434\u0438\u0442\u0435\u043b\u044c"),r.a.createElement(F.a,{onChange:e.onChange,inputProps:{name:"parent",id:"parent-id-select"},value:e.parentId},r.a.createElement("option",{key:0,value:0,"data-slug":"root"},"\u041a\u043e\u0440\u0435\u043d\u044c"),t.id&&r.a.createElement("option",{key:t.id,value:t.id},t.title),a.map((function(e){return r.a.createElement("option",{key:e.id,value:e.id,"data-slug":Object(U.slugify)(e.title)},e.title)}))))),r.a.createElement(z.a,{key:2,item:!0},r.a.createElement(S.a,{"data-create":0,type:"submit",variant:"outlined",color:"primary",size:"large"},"SUBMIT"))),r.a.createElement(Q.a,{type:"hidden",name:"create",value:0}),r.a.createElement(Q.a,{type:"hidden",name:"slug",value:e.slug}))}var de=function(e){function t(e){var a;return Object(i.a)(this,t),(a=Object(c.a)(this,Object(u.a)(t).call(this,e))).state={success:!1,name:void 0,value:void 0},a}return Object(m.a)(t,e),Object(o.a)(t,[{key:"componentDidMount",value:function(){var e=this;h.a.get(g.ApiRequest("/options/get/roles")).then((function(t){console.log(e.state),e.setState(t.data),console.log(e.state)})).catch((function(e){console.log(e)}))}},{key:"render",value:function(){if(this.state.success){var e=JSON.parse(this.state.value.value).role;return r.a.createElement("div",null,r.a.createElement("p",null,e.id,".",e.name,"[",e.access.toString(),"]"))}return""}}]),t}(r.a.Component),me=a(200),pe=a(201),he=a(202),ge=a(60),fe=a(93),ve=a(203),Ee=a(58),be=a.n(Ee),ye=Object(E.a)((function(e){return{root:{flexGrow:1},menuButton:{marginRight:e.spacing(2)},title:{flexGrow:1}}}));function Se(e){var t=ye(),a=e.username||"",n=r.a.useState(null),l=Object(I.a)(n,2),s=l[0],i=l[1];return[r.a.createElement(D.a,null,r.a.createElement(me.a,{position:"static"},r.a.createElement(pe.a,null,r.a.createElement(he.a,{"aria-controls":"menu-top","aria-hidden":"false","aria-haspopup":"false",onClick:function(e){i(e.currentTarget)},edge:"start",className:t.menuButton,color:"inherit","aria-label":"menu"},r.a.createElement(be.a,null)),r.a.createElement(ge.a,{variant:"h6",className:t.title},a,"@ISP.CP"),r.a.createElement(fe.a,{id:"menu-top",anchorEl:s,keepMounted:!0,open:Boolean(s),onClose:function(){i(null)}},r.a.createElement(ve.a,{key:"tm-1"},r.a.createElement(S.a,{component:D.b,to:"/",color:"primary",variant:"contained"},"Home")),r.a.createElement(ve.a,{key:"tm-2"},r.a.createElement(S.a,{component:D.b,to:"/issues/",color:"primary",variant:"contained"},"Issues")),r.a.createElement(ve.a,{key:"tm-3"},r.a.createElement(S.a,{component:D.b,to:"/terms/",color:"primary",variant:"contained"},"Terms"))))),r.a.createElement(R.a,{path:"/issues",component:W}),r.a.createElement(R.a,{path:"/terms",component:oe}),r.a.createElement(R.a,{path:"/options",component:de}))]}var Oe=function(e){function t(e){var a;Object(i.a)(this,t),a=Object(c.a)(this,Object(u.a)(t).call(this,e));var n=f;return a.state={user:n},a.handleSubmitLoginForm=a.handleSubmitLoginForm.bind(Object(d.a)(a)),a}return Object(m.a)(t,e),Object(o.a)(t,[{key:"handleSubmitLoginForm",value:function(e){var t=this;e.preventDefault();var a=e.currentTarget,n=f;n.email=a.email.value,n.pass=a.pass.value,h.a.get(g.ApiRequest("/users/login"),{params:{email:n.email,password:n.pass}}).then((function(e){n.id=e.data.item.id||void 0,t.setState({user:n})})).catch((function(e){console.log(e)}))}},{key:"render",value:function(){var e=this.state.user.email,t=this.state.user.pass,a=this.state.user.id||void 0;if(parseInt(a)>0){h.a.defaults.params={email:e,password:t};var n=e.split("@")[0].toUpperCase();return[r.a.createElement(Se,{username:n})]}return[r.a.createElement(je,null),r.a.createElement(A,{onSubmit:this.handleSubmitLoginForm,email:e,pass:t})]}}]),t}(r.a.Component),ke=Object(E.a)((function(e){return{root:{flexGrow:1},menuButton:{marginRight:e.spacing(2)},title:{flexGrow:1}}}));function je(e){var t=ke(),a=e.username||"";return r.a.createElement(me.a,{position:"static"},r.a.createElement(pe.a,null,r.a.createElement(he.a,{edge:"start",className:t.menuButton,color:"inherit","aria-label":"menu"},r.a.createElement(be.a,null)),r.a.createElement(ge.a,{variant:"h6",className:t.title},a,"@ISP.CP")))}Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var we=a(92),Ae=Object(we.a)({overrides:{MuiButton:{root:{cursor:"pointer"}}}});s.a.render(r.a.createElement(Oe,{theme:Ae}),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[110,1,2]]]);
//# sourceMappingURL=main.6e35bca8.chunk.js.map